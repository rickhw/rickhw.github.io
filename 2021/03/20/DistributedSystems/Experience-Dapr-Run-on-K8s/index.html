<!DOCTYPE HTML>
<head>
  <meta charset="utf-8">
  
  <title>Experience Dapr - Run on K8s | Complete Think</title>

  <meta name="author" content="Rick Hwang">
  <meta name="description" content="上一篇 整理了體驗 Dapr 在本機模式的 Hello World，Dapr 在官方文件稱為 Self-Hosted，這篇要體驗則是 Run on K8s。



PreparationK8s在開始之前，請先確認以下：

K8s Cluster
有足夠的權限對 K8s Cluster 操作。
如果沒">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- properties -->
  <meta property="og:title" content="Experience Dapr - Run on K8s"/>
  <meta property="og:site_name" content="Complete Think"/>
  <meta property="og:type"      content="website" />
  <meta property="og:url" content="https://rickhw.github.io/2021/03/20/DistributedSystems/Experience-Dapr-Run-on-K8s/"/>
  <meta property="og:image" content="/images/DistributedSystems/dapr/lab02/hello-world-rok.png" />
  

  <!-- links -->
  <link rel="alternative" href="/atom.xml" title="Complete Think" type="application/atom+xml">
  <link href="/favicon.png" rel="icon">

  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <!--
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
  -->
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<!--
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'G-74Y1F3F5W0']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
-->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-74Y1F3F5W0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-74Y1F3F5W0');
</script>



  <!-- Facebook SDK -->
  <!-- ref: https://developers.facebook.com/docs/plugins/like-button -->
  <!-- @rickd 2022/02/24
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous"
      src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2&appId=1554905741423841&autoLogAppEvents=1"></script>
  -->
  <!-- @ricka 2022/02/24 -->
  <!-- ref: https://developers.facebook.com/docs/plugins/like-button -->
  <!--
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v13.0&appId=1554905741423841&autoLogAppEvents=1"
    nonce="bd9r2mJp"></script>
  -->

  <!-- @ricka 2022/09/06 -->
  <!-- ref: https://developers.facebook.com/docs/plugins/like-button -->
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v14.0&appId=1554905741423841&autoLogAppEvents=1"
    nonce="opf2Gext"></script>


<meta name="generator" content="Hexo 6.1.0"></head>


<body>

  
<nav id="main-nav" class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand active" href="/">Complete Think</a>

      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  	
		  		
					<li class='dropdown'>
						<a aria-expanded='false' class='dropdown-toggle' data-toggle='dropdown' href='#' role='button'><i class="fa fa-folder"></i>Categories <span class='caret'/></span></a>
		            	<ul class='dropdown-menu' role='menu'>
		            	
						<li><a href="/categories/AWS/">AWS <sup>82</sup></a></li>
						
						<li><a href="/categories/About/">About <sup>29</sup></a></li>
						
						<li><a href="/categories/Blog/">Blog <sup>5</sup></a></li>
						
						<li><a href="/categories/經營管理/Career/">Career <sup>6</sup></a></li>
						
						<li><a href="/categories/Coding/">Coding <sup>10</sup></a></li>
						
						<li><a href="/categories/Computer-Science/">Computer Science <sup>6</sup></a></li>
						
						<li><a href="/categories/Container/">Container <sup>9</sup></a></li>
						
						<li><a href="/categories/Data/">Data <sup>2</sup></a></li>
						
						<li><a href="/categories/DevOps/">DevOps <sup>43</sup></a></li>
						
						<li><a href="/categories/Distributed-Systems/">Distributed Systems <sup>20</sup></a></li>
						
						<li><a href="/categories/GCP/">GCP <sup>8</sup></a></li>
						
						<li><a href="/categories/Linux/">Linux <sup>9</sup></a></li>
						
						<li><a href="/categories/Misc/">Misc <sup>3</sup></a></li>
						
						<li><a href="/categories/OS-X/">OS X <sup>4</sup></a></li>
						
						<li><a href="/categories/Redmine/">Redmine <sup>6</sup></a></li>
						
						<li><a href="/categories/Reference/">Reference <sup>5</sup></a></li>
						
						<li><a href="/categories/DevOps/SRE/">SRE <sup>25</sup></a></li>
						
						<li><a href="/categories/Software-Engineering/">Software Engineering <sup>10</sup></a></li>
						
						<li><a href="/categories/System-Design/">System Design <sup>2</sup></a></li>
						
						<li><a href="/categories/經營管理/人才管理/">人才管理 <sup>10</sup></a></li>
						
						<li><a href="/categories/經營管理/溝通/">溝通 <sup>9</sup></a></li>
						
						<li><a href="/categories/經營管理/知識管理/">知識管理 <sup>4</sup></a></li>
						
						<li><a href="/categories/經營管理/">經營管理 <sup>61</sup></a></li>
						
						<li><a href="/categories/軟體測試/">軟體測試 <sup>14</sup></a></li>
						
						</ul>
					</li>
		  		
		  	
		  		
		  			<li><a href="/2016/10/01/AWS-Study-Roadmap/" title="AWS Study Notes."><i class="fa fa-cloud"></i>AWS</a></li>
		  		
		  	
		  		
		  			<li><a href="/categories/DevOps/" title="DevOps / SRE"><i class="fa fa-crosshairs"></i>DevOps</a></li>
		  		
		  	
		  		
		  			<li><a href="/2017/07/01/Index-Software-Engineering-In-Practice/" title="設計、開發、測試、維運"><i class="fa fa-cogs"></i>軟體工程</a></li>
		  		
		  	
		  		
		  			<li><a href="/2017/07/01/Index-Management/" title="經營、管理、領導、教練、產品"><i class="fa fa-users"></i>經營管理</a></li>
		  		
		  	
		  		
		  			<li><a href="/categories/Reference/" title="參考書、名詞對照表"><i class="fa fa-folder"></i>字典工具</a></li>
		  		
		  	
			</ul>

			<!-- @ricka: menu in right -->
			<ul class='nav navbar-nav navbar-right'>
				<li class='dropdown'>
					<a aria-expanded='false' class='dropdown-toggle' data-toggle='dropdown' href='#' role='button'><i class="fa fa-folder"></i>About<span class='caret'/></span></a>
					<ul class='dropdown-menu' role='menu'>
					
						<li><a href="/2017/12/29/About/About-This-Blog/" title="About this blog" target="_blank"> <i class="fa fa-sitemap"></i>關於這裡</a></li>
					
						<li><a href="/2017/12/29/About/About-Author/" title="" target="_blank"> <i class="fa fa-user"></i>關於作者</a></li>
					
						<li><a href="/2017/09/20/About/Learning-Approaches/" title="" target="_blank"> <i class="fa fa-book"></i>學習法則</a></li>
					
						<li><a href="https://www.gtcafe.com" title="GTCafe Studio" target="_blank"> <i class="fa fa-coffee"></i>GTCafe Studio</a></li>
					
						<li><a href="https://www.gtcafe.com/rickmidi/" title="喝咖啡 聊音樂 (v2021)" target="_blank"> <i class="fa fa-music"></i>喝咖啡 聊音樂 (v2021)</a></li>
					
					</ul>
				</li>
			</ul>
			<!-- @ricka end -->
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
    <div class="content" style="background-color: white;">
       




	
		<!-- @rick, header of article -->
		<!-- original
		<div class="page-header">
			<h1> Experience Dapr - Run on K8s</h1>
		</div>
		-->

		<div class="panel article_title">
			<div class="panel-heading">
    		<h1> Experience Dapr - Run on K8s</h1>
  		</div>
		</div>

	



<div class="row post">
	<!-- cols -->
	
	<div class="col-md-9">
		

			

			<!-- content -->
			<div class="mypage">
				<!-- ref: https://developers.facebook.com/docs/plugins/like-button -->
				<!-- Facebook in front of page -->
				<!--
				<iframe
					src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Frickhw.github.io%2F2021%2F03%2F20%2FDistributedSystems%2FExperience-Dapr-Run-on-K8s%2F&width=450&layout=standard&action=like&size=small&show_faces=true&share=true&height=80&appId=1554905741423841"
					width="450" height="80"
					style="border:none;overflow:hidden"
					scrolling="no" frameborder="0"
					allowTransparency="true" allow="encrypted-media"></iframe>
				-->

				<!-- <div class="fb-like" data-href="https://rickhw.github.io/2021/03/20/DistributedSystems/Experience-Dapr-Run-on-K8s/" data-layout="standard"
					data-action="like" data-size="small" data-show-faces="true" data-share="true"></div>-->

				<div class="fb-like" data-href="https://rickhw.github.io/2021/03/20/DistributedSystems/Experience-Dapr-Run-on-K8s/" data-width="" data-layout="button_count"
					data-action="like" data-size="small" data-share="true"></div>

				<hr />

				<p><a href="/2021/03/11/DistributedSystems/Experience-Dapr-Hello-World/">上一篇</a> 整理了體驗 Dapr 在本機模式的 Hello World，Dapr 在官方文件稱為 <a target="_blank" rel="noopener" href="https://docs.dapr.io/operations/hosting/self-hosted/">Self-Hosted</a>，這篇要體驗則是 <a target="_blank" rel="noopener" href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-overview/">Run on K8s</a>。</p>
<span id="more"></span>

<hr>
<h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><h2 id="K8s"><a href="#K8s" class="headerlink" title="K8s"></a>K8s</h2><p>在開始之前，請先確認以下：</p>
<ul>
<li>K8s Cluster<ol>
<li>有足夠的權限對 K8s Cluster 操作。</li>
<li>如果沒有 K8s 環境可以做 Lab，可以使用輕量化 K8s，像是 minikube、<a target="_blank" rel="noopener" href="https://k3s.io/">K3s</a>、<a target="_blank" rel="noopener" href="https://k0sproject.io/">K0s</a>、K8s on Docker。</li>
<li>或者跟我一樣 <a href="/2019/03/17/Container/Install-K8s-with-Kubeadm/">自裝 K8s Cluster</a>。</li>
</ol>
</li>
<li>K8s Controller &#x2F; Client &#x2F; GUI<ul>
<li>K8s 的管理工具有很多，最基本的是 kubectl。</li>
<li>重量級的則是 rancher，</li>
<li>其他 GUI 像是 <a target="_blank" rel="noopener" href="https://k8slens.dev/">K8s lens</a>、<a target="_blank" rel="noopener" href="https://octant.dev/">octant</a> 也都不錯。</li>
<li>我個人推薦比較輕量、但又容易上手的 <a target="_blank" rel="noopener" href="https://k9scli.io/">k9s</a></li>
</ul>
</li>
</ul>
<p>確認：在開始之前，先確認你的 k8s config 是否有正確的 context 可以使用，可以透過 <code>kubectl config current-context</code> 知道現在狀況。</p>
<blockquote>
<p>底下的筆記，我在 <a href="/2019/03/17/Container/Install-K8s-with-Kubeadm/">自裝 K8s Cluster</a> 以及 K3s 上都跑過。</p>
</blockquote>
<h2 id="Setup-Dapr-Control-Plane"><a href="#Setup-Dapr-Control-Plane" class="headerlink" title="Setup: Dapr Control Plane"></a>Setup: Dapr Control Plane</h2><p>Dapr v1.0 預設所有的 cli 只要加 <code>-k</code> 參數，就會直接把同樣的動作，透過 K8s 權限直接 apply，所以跟上一篇的步驟都一樣。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 直接初始化</span></span><br><span class="line">❯ dapr init -k</span><br><span class="line">⌛  Making the jump to hyperspace...</span><br><span class="line">↑  Downloading binaries and setting up components...</span><br><span class="line">Dapr runtime installed to /Users/rick/.dapr/bin, you may run the following to add it to your path <span class="keyword">if</span> you want to run daprd directly:</span><br><span class="line">    <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/Users/rick/.dapr/bin</span><br><span class="line">✅  Downloaded binaries and completed components <span class="built_in">set</span> up.</span><br><span class="line">ℹ️  daprd binary has been installed to /Users/rick/.dapr/bin.</span><br><span class="line">ℹ️  dapr_placement container is running.</span><br><span class="line">ℹ️  dapr_redis container is running.</span><br><span class="line">ℹ️  dapr_zipkin container is running.</span><br><span class="line">ℹ️  Use `docker ps` to check running containers.</span><br><span class="line">✅  Success! Dapr is up and running. To get started, go here: https://aka.ms/dapr-getting-started</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>順利完成後，可以發現多了一個叫做 <code>dapr-system</code> 的 namespace，查看狀況如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~$ k get po,deploy,svc -n dapr-system</span><br><span class="line">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/dapr-dashboard-79b6846f6c-v5vk5          1/1     Running   0          9d</span><br><span class="line">pod/dapr-operator-7fb567cf76-78mv7           1/1     Running   0          9d</span><br><span class="line">pod/dapr-placement-server-0                  1/1     Running   0          9d</span><br><span class="line">pod/dapr-sentry-6f46dd98c7-qpskp             1/1     Running   0          9d</span><br><span class="line">pod/dapr-sidecar-injector-5fcd998fbb-vxprb   1/1     Running   0          9d</span><br><span class="line"></span><br><span class="line">NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/dapr-dashboard          1/1     1            1           9d</span><br><span class="line">deployment.apps/dapr-operator           1/1     1            1           9d</span><br><span class="line">deployment.apps/dapr-sentry             1/1     1            1           9d</span><br><span class="line">deployment.apps/dapr-sidecar-injector   1/1     1            1           9d</span><br><span class="line"></span><br><span class="line">NAME                            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)              AGE</span><br><span class="line">service/dapr-api                ClusterIP   10.98.196.60    &lt;none&gt;        80/TCP               9d</span><br><span class="line">service/dapr-dashboard          ClusterIP   10.98.17.33     &lt;none&gt;        8080/TCP             9d</span><br><span class="line">service/dapr-placement-server   ClusterIP   None            &lt;none&gt;        50005/TCP,8201/TCP   9d</span><br><span class="line">service/dapr-sentry             ClusterIP   10.108.116.38   &lt;none&gt;        80/TCP               9d</span><br><span class="line">service/dapr-sidecar-injector   ClusterIP   10.107.76.60    &lt;none&gt;        443/TCP              9d</span><br></pre></td></tr></table></figure>

<p>與 <a href="/2021/03/11/DistributedSystems/Experience-Dapr-Hello-World/">上一篇</a> 的本機比較起來，有著明顯的差異，在 k8s 上有以下的 pod 以及大致上的功能:</p>
<ul>
<li><code>dashboard</code>: 這個與本機透過 <code>dapr dashboard</code> 看到的東西一樣</li>
<li><code>operator</code>: operator 會與 sidecar-injector 一起協作，用來依據 app 的 annotation 的宣告，然後動態在 pod 裡面放入 sidecar container，也就是 daprd (Dapr Daemon)</li>
<li><code>placement</code>: 這個是負責處理 actor 的 building block ，<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Actor_model">actor pattern</a> 是用來處理平行運算的分散式演算法。Dapr 實作 <a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/research/project/orleans-virtual-actors/">Virtual Actor pattern</a> 。</li>
<li><code>sentry</code>: Dapr 支援在 pod 之間的傳輸加密，使用的機制為 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Mutual_authentication">mTLS (mutual authentication TLS)</a>，透過一個叫做 <code>Sentry</code> 的角色作為 集中式 CA (Certificate Authority).</li>
<li><code>sidecar-injector</code>: 與 operator 配合，動態置入 sidecar container 到 Pod 裡面。</li>
</ul>
<blockquote>
<p>關於 Actor Pattern 的資訊以及相關論文，整理如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Actor_model">Actor pattern</a></li>
<li><a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/Orleans-MSR-TR-2014-41.pdf">Orleans: Distributed Virtual Actors for Programmability and Scalability</a></li>
</ul>
</blockquote>
<p>上述的 pod 稱為 <code>dapr control Plane</code>。</p>
<p>除了標準的初始化流程，也可以額外指定其他參數，整理如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 指定 namespace</span></span><br><span class="line">dapr init -k -n mynamespace</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始時，每個 pod 有三個</span></span><br><span class="line">dapr init -k --enable-ha=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 關閉 mTLS, 預設是開啟的</span></span><br><span class="line">dapr init -k --enable-mtls=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 移除 dapr control plane</span></span><br><span class="line">dapr uninstall -k</span><br><span class="line"></span><br><span class="line"><span class="comment"># 透過 helm 安裝</span></span><br><span class="line">helm repo add dapr https://dapr.github.io/helm-charts/</span><br><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安裝 1.0.1</span></span><br><span class="line">helm upgrade --install dapr dapr/dapr \</span><br><span class="line">  --version=1.0.1 \</span><br><span class="line">  --namespace dapr-system \</span><br><span class="line">  --create-namespace \</span><br><span class="line">  --<span class="built_in">wait</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 開啟多複本的 pod</span></span><br><span class="line">helm upgrade --install dapr dapr/dapr \</span><br><span class="line">  --version=1.0.1 \</span><br><span class="line">  --namespace dapr-system \</span><br><span class="line">  --create-namespace \</span><br><span class="line">  --<span class="built_in">set</span> global.ha.enabled=<span class="literal">true</span> \</span><br><span class="line">  --<span class="built_in">wait</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 移除</span></span><br><span class="line">helm uninstall dapr --namespace dapr-system</span><br></pre></td></tr></table></figure>

<p>Dapr 更版，例如從 <code>v1.0.0</code> to <code>v1.1.0</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~$ dapr upgrade --runtime-version 1.1.0 -k</span><br><span class="line">ℹ️  Dapr control plane version 1.0.1 detected <span class="keyword">in</span> namespace dapr-system</span><br><span class="line">ℹ️  Starting upgrade...</span><br><span class="line">✅  Dapr control plane successfully upgraded to version 1.1.0. Make sure your deployments are restarted to pick up the latest sidecar version.</span><br><span class="line"></span><br><span class="line">~$ dapr status -k</span><br><span class="line">  NAME                   NAMESPACE    HEALTHY  STATUS   REPLICAS  VERSION  AGE  CREATED</span><br><span class="line">  dapr-operator          dapr-system  True     Running  1         1.1.0    8m   2021-04-07 21:29.36</span><br><span class="line">  dapr-sidecar-injector  dapr-system  True     Running  1         1.1.0    8m   2021-04-07 21:29.36</span><br><span class="line">  dapr-sentry            dapr-system  True     Running  1         1.1.0    8m   2021-04-07 21:29.36</span><br><span class="line">  dapr-dashboard         dapr-system  True     Running  1         0.6.0    8m   2021-04-07 21:29.35</span><br><span class="line">  dapr-placement-server  dapr-system  True     Running  1         1.1.0    8m   2021-04-07 21:29.42</span><br></pre></td></tr></table></figure>

<p>注意，Dapr APP 的 Sidecar 不會自動更版，但只要重新建立 Pod 就 sidecar-injector 就會發配新版。</p>
<hr>
<h1 id="Hello-World-Run-on-K8s"><a href="#Hello-World-Run-on-K8s" class="headerlink" title="Hello World - Run on K8s"></a>Hello World - Run on K8s</h1><p>直接開始主題，同樣使用 <a target="_blank" rel="noopener" href="https://github.com/dapr/quickstarts/tree/v1.0.0/hello-kubernetes">官方的範例</a>，下圖是官方提供的架構圖。</p>
<blockquote>
<p>一些基礎相關資訊請參考 <a href="/2021/03/11/DistributedSystems/Experience-Dapr-Hello-World/">上一篇的介紹</a>。</p>
</blockquote>
<p><img src="/images/DistributedSystems/dapr/lab02/hello-world-rok.png"></p>
<p>我在圖中註記 Pod A, Pod B, Pod C，分別摘要說明：</p>
<ol>
<li><code>Pod A: Dapr.Operator</code>: 是放在 dapr-system ns 裡的 Pod，與 sidecar-injector 配合，動態在 pod 裡面配置 sidecar container</li>
<li><code>Pod B: DaprApp.PythonApp</code>: 模擬 Client 的應用程式，使用 python</li>
<li><code>Pod C: DaprApp.NodeApp</code>: 主要的訂單處理與狀態紀錄</li>
</ol>
<ul>
<li>應用程式：使用 node.js 開發</li>
<li>狀態管理：透過 Dapr 的 <a target="_blank" rel="noopener" href="https://docs.dapr.io/developing-applications/building-blocks/state-management/state-management-overview/">state management</a> (building block 的一種)，在 K8s 則透過自定義 (CRD) 的 component 宣告，使用 redis。這段後面整理詳細概念。</li>
</ul>
<ol>
<li><code>dapr-system</code>: 這個 ns 是一開始 <code>dapr init -k</code> 建立的 ns</li>
<li><code>dapr-lab02</code>: 這是這個 lab 的 app 預定放置的 ns，包含 redis</li>
</ol>
<p>Pod B, Pod C 都有額外的 Dapr Runtime Container，也就是前面提到的 sidecar。</p>
<h2 id="安裝步驟"><a href="#安裝步驟" class="headerlink" title="安裝步驟"></a>安裝步驟</h2><h3 id="1-準備-redis"><a href="#1-準備-redis" class="headerlink" title="1. 準備 redis"></a>1. 準備 redis</h3><p>我直接在 rancher 上透過 application management 安裝。</p>
<h3 id="2-定義-component"><a href="#2-定義-component" class="headerlink" title="2. 定義 component"></a>2. 定義 component</h3><p>Dapr 透過 K8s 的 Component 宣告有哪一些 Building Block 要使用，然後 APP 可以直接透過 Dapr Runtime 的 API 對 Component 的實際資源做操作。</p>
<p>底下是官方提供的 Component 定義，要注意的是 <code>redisHost</code> 要指對，如果錯了 Pod 會起不來。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">dapr.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Component</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dapr-lab02</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">statestore</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">state.redis</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># These settings will work out of the box if you use `helm install</span></span><br><span class="line">  <span class="comment"># bitnami/redis`.  If you have your own setup, replace</span></span><br><span class="line">  <span class="comment"># `redis-master:6379` with your own Redis master address, and the</span></span><br><span class="line">  <span class="comment"># Redis password with your own Secret&#x27;s name. For more information,</span></span><br><span class="line">  <span class="comment"># see https://docs.dapr.io/operations/components/component-secrets .</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redisHost</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">redis-master.dapr-lab02.svc.cluster.local:6379</span></span><br><span class="line">  <span class="comment"># - name: redisPassword</span></span><br><span class="line">  <span class="comment">#   secretKeyRef:</span></span><br><span class="line">  <span class="comment">#     name: redis</span></span><br><span class="line">  <span class="comment">#     key: redis-password</span></span><br><span class="line"><span class="attr">auth:</span></span><br><span class="line">  <span class="attr">secretStore:</span> <span class="string">kubernetes</span></span><br></pre></td></tr></table></figure>

<h3 id="3-apply-deployments-service"><a href="#3-apply-deployments-service" class="headerlink" title="3. apply deployments, service"></a>3. apply deployments, service</h3><p>官方的範例有兩個 services: nodeapp, pythonapp，依照官方文件步驟 apply 即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ./deploy/node.yaml</span><br><span class="line">kubectl apply -f ./deploy/python.yaml</span><br></pre></td></tr></table></figure>

<p>這兩個 yaml 內容要特別說明的是這段 annotations：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">template:</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">dapr.io/enabled:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">      <span class="attr">dapr.io/app-id:</span> <span class="string">&quot;nodeapp&quot;</span></span><br><span class="line">      <span class="attr">dapr.io/app-port:</span> <span class="string">&quot;3000&quot;</span></span><br></pre></td></tr></table></figure>

<p>Dapr control plane 會依據這段 annotations：</p>
<ol>
<li>動態增加 Dapr sidecar 到 pod 裡</li>
<li>同時增加一個叫做 <code>&lt;appneme&gt;-dapr</code> 的 Headless Service (No ClusterIP)</li>
</ol>
<h3 id="4-檢查"><a href="#4-檢查" class="headerlink" title="4. 檢查"></a>4. 檢查</h3><p>完成部署後，檢查會看到以下資源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">~$ k get po,deploy,svc,components</span><br><span class="line"></span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nodeapp-d5b697767-62js6      2/2     Running   0          33h</span><br><span class="line">pod/pythonapp-7797554b99-jxs7q   2/2     Running   0          33h</span><br><span class="line">pod/redis-master-0               1/1     Running   0          33h</span><br><span class="line">pod/zipkin-789f9f965f-9zq49      1/1     Running   5          35h</span><br><span class="line"></span><br><span class="line">NAME                        READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/nodeapp     1/1     1            1           35h</span><br><span class="line">deployment.apps/pythonapp   1/1     1            1           35h</span><br><span class="line">deployment.apps/zipkin      1/1     1            1           35h</span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                               AGE</span><br><span class="line">service/nodeapp-dapr      ClusterIP   None             &lt;none&gt;        80/TCP,50001/TCP,50002/TCP,9090/TCP   35h</span><br><span class="line">service/nodeapp-service   ClusterIP   10.102.6.181     &lt;none&gt;        80/TCP                                35h</span><br><span class="line">service/pythonapp-dapr    ClusterIP   None             &lt;none&gt;        80/TCP,50001/TCP,50002/TCP,9090/TCP   35h</span><br><span class="line">service/redis-headless    ClusterIP   None             &lt;none&gt;        6379/TCP                              35h</span><br><span class="line">service/redis-master      ClusterIP   10.96.235.86     &lt;none&gt;        6379/TCP                              35h</span><br><span class="line">service/zipkin            ClusterIP   10.101.186.178   &lt;none&gt;        9411/TCP                              35h</span><br><span class="line"></span><br><span class="line">NAME                           AGE</span><br><span class="line">component.dapr.io/statestore   35h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 透過 dapr cli 看 dapr app</span></span><br><span class="line">~$ dapr list -k</span><br><span class="line">  APP ID          APP PORT  AGE  CREATED</span><br><span class="line">  nodeapp         3000      1d   2021-03-18 23:06.06</span><br><span class="line">  pythonapp                 1d   2021-03-18 23:35.20</span><br></pre></td></tr></table></figure>

<blockquote>
<p>過程可能會遇到因為 docker rate limit 問題而無法建立 Container: You have reached your pull rate limit. You may increase the limit by authenticating and upgrading: <a target="_blank" rel="noopener" href="https://www.docker.com/increase-rate-limit">https://www.docker.com/increase-rate-limit</a></p>
</blockquote>
<p>觀察上述的 Pod 與 Service 的內容：</p>
<ol>
<li>Pod 裡面除了 NodeAPP, PytonnApp 之外，他們都自動產生一個 Dapr Sidecar，如下圖：<br><img src="/images/DistributedSystems/dapr/lab02/dapr-sidecar.png"></li>
<li>如前述，自動產生名為 <code>nodeapp-dapr</code>, <code>pythonapp-dapr</code> 的 Headless Service.</li>
</ol>
<p>上述 pod 的結構如下圖：<br><img src="/images/DistributedSystems/dapr/concepts/kubernetes-hosted-dapr-sidecar.png"><br>圖片來源：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/dotnet/architecture/dapr-for-net-developers/dapr-at-20000-feet">Dapr at 20,000 feet</a></p>
<p>最後可以透過 dapr dashboard 看看，先確認右上角的 scope 是正確的 ns，然後 overview 會看到兩個 Dapr Applications，如下圖：</p>
<p><img src="/images/DistributedSystems/dapr/lab02/dashboard.png"></p>
<h2 id="測試"><a href="#測試" class="headerlink" title="測試"></a>測試</h2><p>用以下位址測試 NodeApp，順利的話，會回傳 DAPR 的 HTTP &#x2F; gRPC 的 Ports。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl port-forward service/nodeapp-service 8080:80</span><br><span class="line">~$ curl  http://localhost:8080/ports</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;DAPR_HTTP_PORT&quot;</span>:<span class="string">&quot;3500&quot;</span>,<span class="string">&quot;DAPR_GRPC_PORT&quot;</span>:<span class="string">&quot;50001&quot;</span>&#125;%</span><br></pre></td></tr></table></figure>

<p>pythonapp 是模擬 下訂單的服務，每秒會對 nodeapp 的 <code>/neworder</code> 打一次，所以直接對 node container 看 log 會看到以下訊息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ k logs -f nodeapp-d5b697767-v9tms</span><br><span class="line">Node App listening on port 3000!</span><br><span class="line">Got a new order! Order ID: 4714</span><br><span class="line">Successfully persisted state.</span><br><span class="line">Got a new order! Order ID: 4715</span><br><span class="line">Successfully persisted state.</span><br></pre></td></tr></table></figure>

<p>我這已經跑一段時間了，所以序號已經跑到 47xx 了 XDD</p>
<p>如果出現以下訊息，則表示 redis 有問題，component 定義沒問題：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ k logs -f nodeapp-d5b697767-62js6 node</span><br><span class="line">Got a new order! Order ID: 5375</span><br><span class="line">Failed to persist state.</span><br><span class="line">Got a new order! Order ID: 5376</span><br><span class="line">Failed to persist state.</span><br></pre></td></tr></table></figure>

<p>component 定義有問題，則 pod 會起不來。但如果 pod 啟動後，redis 壞了，則會出現上述問題，同時無法再長新的 pod，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ k get po</span><br><span class="line">NAME                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">nodeapp-d5b697767-62js6      2/2     Running   0          3m10s</span><br><span class="line">nodeapp-d5b697767-c4vvh      1/2     Error     0          24s</span><br><span class="line">pythonapp-7797554b99-5vm6c   2/2     Running   0          100m</span><br><span class="line">zipkin-789f9f965f-9zq49      1/1     Running   0          112</span><br></pre></td></tr></table></figure>


<h2 id="完整使用情境：下訂單、取得訂單"><a href="#完整使用情境：下訂單、取得訂單" class="headerlink" title="完整使用情境：下訂單、取得訂單"></a>完整使用情境：下訂單、取得訂單</h2><p>發送一個 POST 給 Application，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 啟動 forward</span></span><br><span class="line">~$ kubectl port-forward service/nodeapp-service 8080:80</span><br><span class="line"></span><br><span class="line"><span class="comment">## 下訂單</span></span><br><span class="line">~$ curl -X POST \</span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;data&quot;: &#123; &quot;orderId&quot;: &quot;42&quot; &#125; &#125;&#x27;</span> \</span><br><span class="line">  http://localhost:8080/neworder</span><br><span class="line"></span><br><span class="line"><span class="comment">## 取得訂單</span></span><br><span class="line">curl http://localhost:8080/order</span><br><span class="line">&#123;<span class="string">&quot;orderId&quot;</span>:42&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述的進入點和 <a href="/2021/03/11/DistributedSystems/Experience-Dapr-Hello-World/">Lab01</a> 是不一樣的。</p>
<h2 id="進入點的差異"><a href="#進入點的差異" class="headerlink" title="進入點的差異"></a>進入點的差異</h2><p>在了解架構時，清楚 E2E 經過的路徑很重要，在 <a href="/2019/10/04/DevOps/How-to-Figure-out-the-RootCause-for-an-AbnormalSystem-In-ZeroTime/">系統發生異常時，第一時間如何快速止血？</a> 一文中的第一點就提到這樣的思路。</p>
<p>所以如果有跟著上一篇做過一次，就會發現這次打的 endpoint 路徑跟上次的不一樣，整理兩次的進入點 (entry point)，底下是第一次的 Lab01 - Self-Hosted：</p>
<p><img src="/images/DistributedSystems/dapr/lab02/compare-entry-point-self-hosted.png"></p>
<p>底下這張圖是這次的 Run on K8s Lab02 的進入點：</p>
<p><img src="/images/DistributedSystems/dapr/lab02/compare-entry-point-k8s.png"></p>
<p>我嘗試把 Lab02 測試，調整到 Dapr sidecar，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 啟動 forward</span></span><br><span class="line">~$ kubectl port-forward service/nodeapp-dapr 8080:80</span><br><span class="line"></span><br><span class="line"><span class="comment">## 下訂單</span></span><br><span class="line">~$ curl -X POST \</span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;&quot;data&quot;: &#123; &quot;orderId&quot;: &quot;43&quot; &#125; &#125;&#x27;</span> \</span><br><span class="line">  http://localhost:8080/v1.0/invoke/nodeapp/method/neworder</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 取得 dapr app metadata</span></span><br><span class="line">curl http://localhost:8080/v1.0/metadata</span><br><span class="line"></span><br><span class="line"><span class="comment">## 測試 ports 資訊</span></span><br><span class="line">curl http://localhost:8080/v1.0/invoke/nodeapp/method/ports</span><br><span class="line"></span><br><span class="line"><span class="comment">## 取得訂單</span></span><br><span class="line">curl http://localhost:8080/v1.0/invoke/nodeapp/method/order</span><br></pre></td></tr></table></figure>

<p>結果是不行的，因為在 K8s 裡的 Dapr Sidecar Service，預設 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/services-networking/service/#headless-services">Headless Service</a>，所以不會有 ClusterIp，透過 Ingress 就可以存取。如果是使用 minikube 記得把 ingress 打開。</p>
<!--
## 觀察到的


* 觀察
  * 每個自動 dapr app 都會產生 Sidecar: Dapr Runtime, Service
  * dapr control plane 是必要的。

-->

<!--

## 整合 Distributed Tracing: zipkin

~$ kubectl port-forward service/zipkin 9411:9411




## 讓我注意到的一些東西

* Building Block 與 Components 的設計概念：除了 Sidecar Pattern，這兩個是 dapr 的整個架構核心，基於這個想法，可以讓 dapr 很優雅處理 microservice 要處理的難題。
* Service Invocation: 使用 Secure Production Identity Framework for Everyone - [SPIFFE](https://spiffe.io/)，包含了 JWT, [X.509 SPIFFE](https://github.com/spiffe/spiffe/blob/master/standards/X509-SVID.md), API Keys ... 等服務架構都要面對的資安課題
  * [name resolution](https://github.com/dapr/components-contrib/tree/master/nameresolution): mdns, kubernetes
* Secret Management: 除了上述的 SPIFFE, 另外也透過 Component 的方式提供了各家 Secret Management / Store 的整合
  * 通訊過程的資料加密使用 mTLS
  * API 的權限管控機制：[Service Invocation ACLs](https://docs.dapr.io/operations/configuration/invoke-allowlist/)
  * 限流: [Limit the secrets that can be read from secret stores](https://docs.dapr.io/operations/configuration/secret-scope/)
* Distributed Tracing: [zipkin](https://zipkin.io/), [OpenTelemetry Collector](https://github.com/open-telemetry/opentelemetry-collector), [jaeger](https://www.jaegertracing.io/docs/1.21/getting-started/#all-in-one)
* State management: 同樣透過 Building Block 的 Component，提供各種常用的 Store，從通用性的 RDB / NoSQL / Caceh，Cloud base 像 AWS DDB, GCP Firestore, Azure CosmosDB ... 等，列表參閱 [Supported state stores](https://docs.dapr.io/operations/components/setup-state-store/supported-state-stores/)
* Component: 直接使用 K8s CRD (類似於 Plugin/Extension 的方法)，直接讓 dapr 原生與 K8s 做完美的整合。





-->

<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><p>Q1: Run on K8s 的 <code>外部</code> 請求，應該打 NodeApp 的 Service ？還是打 Dapr Sidecar？</p>
<blockquote>
<p>可以，只要 Ingress 指定到 <code>&lt;appid&gt;-dapr</code> service 的 80 ，然後就可以打 Dapr API，例如 <code>/v1.0/metadata</code> 可以當 health check.</p>
<p>這牽涉到整體架構 <code>規劃</code> 與 <code>設計</code> 問題，以目前 Dapr 的設計 Sidecar 是內部通訊使用的，外部通訊則還是透過 Ingress。</p>
<ul>
<li><code>規劃</code>: 指的是整個服務的應用對象與場景</li>
<li><code>設計</code>: 是能否滿足應用場景的需求能力。<br>這段後面有個更完整應用案例整理。</li>
</ul>
</blockquote>
<p>Q2: 如何針對 Dapr App 做 Health Check？</p>
<blockquote>
<p>參考 Dapr 官方文件：<a target="_blank" rel="noopener" href="https://docs.dapr.io/developing-applications/building-blocks/observability/sidecar-health/">Sidecar healthz</a></p>
</blockquote>
<p>Q3: 怎麼配置 sidecar 的設定？範圍是怎麼圈的？</p>
<blockquote>
<p>Dapr 每個應用程式都可以有自己的 <code>Sidecar Config</code> 和 <code>Control-plane</code> 的 Configuration，詳細參閱 <a target="_blank" rel="noopener" href="https://docs.dapr.io/operations/configuration/configuration-overview/">Dapr configuration options</a></p>
</blockquote>
<p>Q4: Sidecar 透過 annotation 設定，有哪一些可以使用？</p>
<blockquote>
<p>參閱 <a target="_blank" rel="noopener" href="https://docs.dapr.io/operations/hosting/kubernetes/kubernetes-annotations/">Dapr Kubernetes pod annotations spec</a></p>
</blockquote>
<p>Q5: K8s Service &#x2F; Ingress 可以直接接到 Dapr Sidecar Service？</p>
<blockquote>
<p>可以。<br>實際使用情境同 Q1：Dapr Sidecar 的用途是 App 之間溝通使用的，也就是內部通訊的介面，對外的 入口還是會直接到 app 而不會經過 sidecar。更實際的案例可以參考這個： <a target="_blank" rel="noopener" href="https://github.com/dotnet-architecture/eShopOnDapr">eShopOnDapr</a></p>
</blockquote>
<p>Q6: mTLS 是 E2E 外部的資料加密？</p>
<blockquote>
<p>他是 Dapr Instance 之間的通訊加密，不是 E2E。官方說明：<code>Dapr supports in-transit encryption of communication between Dapr instances using Sentry, a central Certificate Authority</code>。詳細參閱 <a target="_blank" rel="noopener" href="https://docs.dapr.io/concepts/security-concept/#sidecar-to-sidecar-communication">Sidecar-to-sidecar communication</a></p>
</blockquote>
<p>Q7: Dapr Sidecar 都沒有 log，怎麼 debug？</p>
<blockquote>
<p><del>目前官方文件沒找到可以調整的。</del><br>20210407 Updated: v1.1.0 會提供 debug flag, 參閱 <a target="_blank" rel="noopener" href="https://github.com/dapr/dapr/pull/3008/files/72a0117eb6f5a7ecec489c1b15969b197dbabfde..02373023dfb680dbb56dd9ac78a2538ee262606b">K8S debug support #3008</a></p>
</blockquote>
<p>Q8: dapr 的 sidecar 是從 docker.io 抓，遇到 rate limit 怎麼辦？</p>
<blockquote>
<p>底下討論串有這議題，看起來暫時是： <code>ImagePullPolicy</code> for Dapr sidecar Docker image from <code>Allways</code> to <code>IfNotPresent</code></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/dapr/dapr/issues/2444">https://github.com/dapr/dapr/issues/2444</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dapr/dapr/pull/2447">https://github.com/dapr/dapr/pull/2447</a></li>
</ul>
<p>上面 Issue 已經在 1.0.0M2 Merge PR, <a target="_blank" rel="noopener" href="https://github.com/dapr/dapr/blob/master/charts/dapr/charts/dapr_sidecar_injector/templates/dapr_sidecar_injector_deployment.yaml">Source Code</a> 也 Merge 了，但是文件沒有提到如何設定。</p>
<p>但是在 Dapr Control Plane 的 <code>dapr-sidecar-injector</code>，環境變數有找到以下變數可以設定：</p>
<ul>
<li><code>SIDECAR_IMAGE_PULL_POLICY</code>: v1.0.0 預設是 <code>Always</code>，v1.1.0 改成 <code>IfNotPresent</code></li>
<li><code>SIDECAR_IMAGE</code>: 可以改成自己的 private registry.</li>
</ul>
<p><img src="/images/DistributedSystems/dapr/lab02/dapr-sidecar-injector_env.png"></p>
</blockquote>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><p>Q: Dapr App 的 Pod 起不來？</p>
<p>先到 Pod 裡面看看是否每個 Container 都正常，如果是 <code>daprd</code> 有問題，那可能是 Component 定義的 <code>redisHost</code> 問題，可以從 log 中確認狀況，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">daprd time=<span class="string">&quot;2021-03-18T14:47:30.141871173Z&quot;</span> level=warning msg=<span class="string">&quot;error initializing state store statestore (state.redis/v1): redis store: err</span></span><br><span class="line"><span class="string">│ or connecting to redis at redis-master.dapr-lab2.svc.cluster.local:6379: dial tcp: lookup redis-master.dapr-lab2.svc.cluster.local on 10.96</span></span><br><span class="line"><span class="string">│ .0.10:53: no such host&quot;</span> app_id=nodeapp instance=nodeapp-d5b697767-s9k5s scope=dapr.runtime <span class="built_in">type</span>=<span class="built_in">log</span> ver=1.0.1</span><br><span class="line">│ daprd time=<span class="string">&quot;2021-03-18T14:47:30.141916107Z&quot;</span> level=fatal msg=<span class="string">&quot;process component statestore error: redis store: error connecting to redis at</span></span><br><span class="line"><span class="string">│ redis-master.dapr-lab2.svc.cluster.local:6379: dial tcp: lookup redis-master.dapr-lab2.svc.cluster.local on 10.96.0.10:53: no such host&quot;</span> ap</span><br><span class="line">│ p_id=nodeapp instance=nodeapp-d5b697767-s9k5s scope=dapr.runtime <span class="built_in">type</span>=<span class="built_in">log</span> ver=1.0.1</span><br></pre></td></tr></table></figure>

<p>確認問題，把 component 定義檔修好，長新的 pod 應該就好了。</p>
<hr>
<h1 id="小結"><a href="#小結" class="headerlink" title="小結"></a>小結</h1><p>這個案例的過程，帶出 Dapr 設計背後的意圖，也就是解決大型分散式系統的核心問題：</p>
<blockquote>
<p>複雜度</p>
</blockquote>
<p>降低複雜度的原則是 <code>分而治之</code>，Dapr 最核心的概念就是 <a target="_blank" rel="noopener" href="https://techcommunity.microsoft.com/t5/azure-architecture-blog/sidecar-pattern-in-action/ba-p/1714983">Sidecar Pattern</a> + <code>Building Block</code>，如下圖：</p>
<p><img src="/images/DistributedSystems/dapr/concepts/self-hosted-dapr-sidecar.png"><br>圖片來源：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/dotnet/architecture/dapr-for-net-developers/dapr-at-20000-feet">Dapr at 20,000 feet</a></p>
<ul>
<li><code>Sidecar Pattern</code>: 透過職責分離與 Container 的隔離特性，降低應用程式的複雜度。更多 Container 隔離的概念參閱： <a href="/2020/02/08/Container/Why-Container/">為什麼要使用容器？</a>、<a href="/2021/03/17/Container/Java-Obsolete-in-Age-of-Docker/">Java Obsolete in the Age of Docker</a></li>
<li><code>Building Block</code>: 類似於積木組裝的想法，透過 Dapr 提供的核心組件 (Component)，分離與抽象化系統架構。</li>
</ul>
<!--
1. Building Block
  1. [Service Invocation](https://docs.dapr.io/developing-applications/building-blocks/service-invocation/service-invocation-overview/)
  1. [State Management](https://docs.dapr.io/developing-applications/building-blocks/state-management/state-management-overview/)
1. Communication: Sidecar-to-app, Sidecar-to-sidecar
1. Security

重要的實踐方法：

1. [Service discovery name resolution](https://github.com/dapr/components-contrib/tree/master/nameresolution)
1. mTLS
1. Dapr Control Plane & Configuration
1. Dapr Sidecar, Configuration, Dapr API

-->

<p><a href="/2021/04/07/DistributedSystems/Dapr-Concepts-and-Designing/">下一篇</a> 將整理 Dapr 核心的重要設計概念與實踐。</p>
<hr>
<h1 id="延伸閱讀"><a href="#延伸閱讀" class="headerlink" title="延伸閱讀"></a>延伸閱讀</h1><h2 id="Dapr-系列文章"><a href="#Dapr-系列文章" class="headerlink" title="Dapr 系列文章"></a>Dapr 系列文章</h2><ul>
<li><a href="/2021/04/07/DistributedSystems/Dapr-Concepts-and-Designing/">摘要 Dapr 的設計與概念</a></li>
<li><a href="/2021/03/11/DistributedSystems/Experience-Dapr-Hello-World/">Experience Dapr - Hello World</a></li>
<li><a href="/2021/03/20/DistributedSystems/Experience-Dapr-Run-on-K8s/">Experience Dapr - Run on K8s</a></li>
<li><a href="/2021/05/08/DistributedSystems/Experience-Dapr-Secret-Store/">Experience Dapr - Secret Store</a></li>
<li><a href="/2021/07/11/DistributedSystems/Experience-Dapr-PubSub/">Experience Dapr - Pub&#x2F;Sub</a></li>
</ul>
<h2 id="分散式系統系列文章"><a href="#分散式系統系列文章" class="headerlink" title="分散式系統系列文章"></a>分散式系統系列文章</h2><ul>
<li><a href="/2018/06/18/DistributedSystems/Gossip-in-Distributed-Systems/">聊聊分散式系統</a></li>
<li><a href="/2018/08/11/DistributedSystems/Distributed-Consistency-and-Consensus-Algorithm/">分散式一致性問題與共識演算法</a></li>
<li><a href="/2018/08/11/DistributedSystems/CAP-Theorem/">CAP Theorem</a></li>
<li><a href="/2018/06/18/DistributedSystems/Distributed-Message-Systems/">Distributed Message Systems</a></li>
<li><a href="/2018/12/09/DistributedSystems/Eventually-Consistent-Dynamo-NWR/">Eventually Consistent 與 Dynamo NWR 模型</a></li>
<li><a href="/2020/05/16/DistributedSystems/Distributed-Transactions/">淺談分散式交易</a></li>
<li><a href="/2018/06/18/DistributedSystems/Design-Patterns-for-Distributed-Systems/">Design Patterns for Distributed Systems</a></li>
<li><a href="/2019/05/17/About/DDS-zh_TW/">分散式系統設計 - 正體中文版翻譯記事</a></li>
</ul>
<h2 id="站內文章"><a href="#站內文章" class="headerlink" title="站內文章"></a>站內文章</h2><ul>
<li><a href="/2020/02/08/Container/Why-Container/">為什麼要使用容器？</a></li>
<li><a href="/2021/03/17/Container/Java-Obsolete-in-Age-of-Docker/">Java Obsolete in the Age of Docker</a></li>
<li><a href="/2019/03/17/Container/Install-K8s-with-Kubeadm/">K8s 學習筆記 - kubeadm 手動安裝</a></li>
<li><a href="/2019/10/04/DevOps/How-to-Figure-out-the-RootCause-for-an-AbnormalSystem-In-ZeroTime/">系統發生異常時，第一時間如何快速止血？</a></li>
</ul>
<h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/dotnet/architecture/dapr-for-net-developers/dapr-at-20000-feet">Dapr at 20,000 feet</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/dotnet/architecture/dapr-for-net-developers/the-world-is-distributed">The world is distributed</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dotnet-architecture/eShopOnDapr">eShopOnDapr</a></li>
<li><a target="_blank" rel="noopener" href="https://techcommunity.microsoft.com/t5/azure-architecture-blog/sidecar-pattern-in-action/ba-p/1714983">Sidecar Pattern in Action</a></li>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/services-networking/service/#headless-services">K8s Service - Headless Service</a></li>
</ul>


				<hr />

				<!-- Facebook in bend of page -->
				<div class="fb-like" data-href="https://rickhw.github.io/2021/03/20/DistributedSystems/Experience-Dapr-Run-on-K8s/" data-width="" data-layout="button_count"
					data-action="like" data-size="small" data-share="true"></div>

				<hr />

				<!-- LikeCoin -->
				<!-- @rickd 2022/09/06 -->
				<!--
				<iframe data-v-b66e9a5a=""
					src="https://button.like.co/in/embed/rick_kyhwang/button?referrer=https://rickhw.github.io/2021/03/20/DistributedSystems/Experience-Dapr-Run-on-K8s/"
					frameborder="0" class="lc-margin-top-64 lc-margin-bottom-32 lc-mobile">
				</iframe>
				<br />
				-->

				<div>
					<center>
						
<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/2021/04/07/DistributedSystems/Dapr-Concepts-and-Designing/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/categories"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2021/03/17/Container/Java-Obsolete-in-Age-of-Docker/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

					</center>
				</div>


				<!-- comment -->
				
<section id="comment">
  <h2 class="title">Comments</h2>

	<!-- @rick add for facebook -->
	<!-- <div class='fb-comments' data-num-posts='10' data-width='100%' expr:href='data:post.url'/> -->
  <!-- @ricka 2022/09/06, ref: https://developers.facebook.com/docs/plugins/comments/ -->
  <div class="fb-comments" data-order-by="reverse-time" data-href="https://rickhw.github.io/2021/03/20/DistributedSystems/Experience-Dapr-Run-on-K8s/" data-width="100%" data-numposts="10"></div>

  


</section>






			</div>



		</div> <!-- col-md-9/col-md-12 -->

		
		<!-- meta in right -->
		<div class="col-md-3">

	<!-- date -->
	
	<div class="meta-widget">
		<i class="fa fa-clock-o"></i>
		2021/03/20 03:30:00
	</div>
	

	<hr />

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i> Table of Content</a>
	   <div id="toc" class="toc collapse in">
				<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Preparation"><span class="toc-article-text">Preparation</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#K8s"><span class="toc-article-text">K8s</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Setup-Dapr-Control-Plane"><span class="toc-article-text">Setup: Dapr Control Plane</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Hello-World-Run-on-K8s"><span class="toc-article-text">Hello World - Run on K8s</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%AE%89%E8%A3%9D%E6%AD%A5%E9%A9%9F"><span class="toc-article-text">安裝步驟</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#1-%E6%BA%96%E5%82%99-redis"><span class="toc-article-text">1. 準備 redis</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#2-%E5%AE%9A%E7%BE%A9-component"><span class="toc-article-text">2. 定義 component</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#3-apply-deployments-service"><span class="toc-article-text">3. apply deployments, service</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#4-%E6%AA%A2%E6%9F%A5"><span class="toc-article-text">4. 檢查</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%B8%AC%E8%A9%A6"><span class="toc-article-text">測試</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E6%83%85%E5%A2%83%EF%BC%9A%E4%B8%8B%E8%A8%82%E5%96%AE%E3%80%81%E5%8F%96%E5%BE%97%E8%A8%82%E5%96%AE"><span class="toc-article-text">完整使用情境：下訂單、取得訂單</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%80%B2%E5%85%A5%E9%BB%9E%E7%9A%84%E5%B7%AE%E7%95%B0"><span class="toc-article-text">進入點的差異</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Q-amp-A"><span class="toc-article-text">Q&amp;A</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Troubleshooting"><span class="toc-article-text">Troubleshooting</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%B0%8F%E7%B5%90"><span class="toc-article-text">小結</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%BB%B6%E4%BC%B8%E9%96%B1%E8%AE%80"><span class="toc-article-text">延伸閱讀</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Dapr-%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0"><span class="toc-article-text">Dapr 系列文章</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%88%86%E6%95%A3%E5%BC%8F%E7%B3%BB%E7%B5%B1%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0"><span class="toc-article-text">分散式系統系列文章</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%AB%99%E5%85%A7%E6%96%87%E7%AB%A0"><span class="toc-article-text">站內文章</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99"><span class="toc-article-text">參考資料</span></a></li></ol></li></ol>
		</div>
	
	</div>

	<hr />

	<!-- categories -->
  
	<div class="meta-widget">
		<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i> Categories</a>
    <!--<ul id="categorys" class="tag_box list-unstyled collapse in">-->
      <div>
  <!--<li>-->
    <span class="label label-info"><a href="/categories/Distributed-Systems/" style="color: white">Distributed Systems <span class="badge">20</span></a></span>
  <!--</li>-->
</div>
    <!--</ul>-->
	</div>
	

	<hr />

	<!-- tags -->
	
	<div class="meta-widget">
		<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"> Tags</i></a>
    <!--<ul id="tags" class="tag_box list-unstyled collapse in">-->
    <div>
	  	
  <span class="label label-success"><a href="/tags/K8s/" style="color: white">K8s <span class="badge">12</span></a></span> <span class="label label-success"><a href="/tags/Microservices/" style="color: white">Microservices <span class="badge">12</span></a></span> <span class="label label-success"><a href="/tags/Dapr/" style="color: white">Dapr <span class="badge">5</span></a></span> <span class="label label-success"><a href="/tags/Sidecar/" style="color: white">Sidecar <span class="badge">5</span></a></span> <span class="label label-success"><a href="/tags/Building-Block/" style="color: white">Building Block <span class="badge">2</span></a></span>
	  </div>
    <!--</ul>-->
	</div>
	


  <hr />

	<div class="meta-widget">
		<!-- v4 -->
		<h4>About</h4>
		
			<li><a href="/2035/01/21/Index/">全站索引</a></li>
		
			<li><a href="/2017/12/29/About/About-This-Blog/">關於這裏</a></li>
		
			<li><a href="/2017/12/29/About/About-Author/">關於作者</a></li>
		
			<li><a href="/2017/09/20/About/Learning-Approaches/">學習法則</a></li>
		
			<li><a href="/2017/11/26/Thinking-in-Essence/">思考本質</a></li>
		
			<li><a href="/2017/12/02/About/Epiphany/">一些領悟</a></li>
		
			<li><a href="/2014/10/26/Management/Classified-Philosophy/">分類哲學</a></li>
		

		<h4>著作</h4>
		
			<li><a href="/2023/07/17/About/2023-SRE-Practice-and-IDP/">個人著作：SRE實踐與開發平台指南</a></li>
		
			<li><a href="/2023/05/23/About/2023-Software-Test-Practice/">共同著作：軟體測試實務 (2023)</a></li>
		
			<li><a href="/2019/05/17/About/DDS-zh_TW/">譯著：分散式系統設計 (2019)</a></li>
		

		<h4>演講</h4>
		
			<li><a target="_blank" rel="noopener" href="https://www.youtube.com/playlist?list=PL63J1r2PBvoiKFC40HTdSrGSQVBqOutOf">演講錄影 @ Youtube</a></li>
		
			<li><a href="/2023/09/09/About/2023-AWS-Career-Exploration-Day/">探索職涯、複利人生 - AWS Career Exploration Day 2023</a></li>
		
			<li><a href="/2023/07/17/About/2023-SRE-Practice-and-IDP/">個人著作 SRE 書友見面會</a></li>
		
			<li><a href="/2023/05/23/About/2023-Software-Test-Practice/">軟體測試實務 - 新書發表會</a></li>
		
			<li><a href="/2022/12/21/About/2022-AWS-Career-Exploration-Day/">探索職涯、成就未來 - AWS Career Exploration Day 2022</a></li>
		
			<li><a href="/2022/08/13/SQA/Path-to-Software-Testing/">從理想、到現實的距離，開啟品味軟體測試之路</a></li>
		
			<li><a href="/2022/05/10/About/2022-SREConf2022/">91APP 在 AWS 上的 SRE 實踐之路</a></li>
		
			<li><a target="_blank" rel="noopener" href="https://www.slideshare.net/rickhwang/2020-aws-summit-aws">在矩陣型組織裡，如何有效管理 AWS 的成本結構與系統架構</a></li>
		
			<li><a target="_blank" rel="noopener" href="https://www.slideshare.net/rickhwang/aws-using-aws-for-disaster-recovery/">災難演練 @ AWS 實戰分享</a></li>
		
			<li><a href="/2019/04/27/DevOps/Introduce-to-Continuous-Delivery-2/">導讀持續交付 2.0 - 談當代軟體交付之虛實融合</a></li>
		
			<li><a href="/2019/03/28/DevOps/DevOpsTaiwan-Meetup-Beginning-in-Artifacts-Management/">聊聊軟體交付的濫觴 談產出物管理</a></li>
		
			<li><a href="/2018/09/12/DevOps/DevOpsDaysTaipei2018-Emergency-And-Incident-Management/">從緊急事件 談 SRE 應變能力的培養</a></li>
		
			<li><a href="/2018/07/18/About/20180718-API-Gateway/">邁向 API 經濟 - API Gateway 導入之旅</a></li>
		
			<li><a href="/2018/05/26/About/201805-Monitoring-Tools-CloudWatch/">Monitoring Tools 大亂鬥 - AWS CloudWatch</a></li>
		
			<li><a href="/2018/03/29/About/2018-Serverless-All-Star/">Ops as Code using Serverless</a></li>
		
			<li><a href="/2017/06/21/AWS/Stategies-System-Monitor_and_CloudWatch/">淺談系統監控與 CloudWatch 的應用</a></li>
		

		<!-- v3 -->
		<!--
		<li><a href="/2018/07/08/Index/">部落格索引</a></li>
		<li><a href="/2017/12/29/About/About-This-Blog/">關於這個部落格</a></li>
		<li><a href="/2017/12/29/About/About-Author/">關於作者</a></li>
		<li><a href="/2017/09/20/About/Learning-Approaches/">學習法則</a></li>
		<li><a href="/2014/12/27/Management/經營之道/">經營之道</a></li>
		<li><a href="/2017/12/02/About/Epiphany/">一些領悟</a></li>
		-->

		<!-- v2 -->
		<!-- <a href="/2017/07/01/Management/Developer-or-Engineer/">軟體開發者 (Software Developer)</a>、<a target="_blank" rel="noopener" href="http://rickmidi.blogspot.com/">音樂愛好者</a>，工作角色經歷 DevOps 三個圈圈職務: Dev / <a href="/categories/軟體測試/">QA</a> / <a href="/categories/DevOps/">Ops</a>。這幾年專注在經營管理、<a href="/2016/10/01/AWS-Study-Roadmap/">AWS</a> / GCP、分散式架構、<a href="/categories/DevOps/">維運、DevOps / SRE</a> 等領域，並活躍於各大社群的活動、演講，著有技術部落格：<a href="https://rickhw.github.io/">Complete Think</a>。工作之外也是業餘音樂愛好者，專注在 吉他、鍵盤、編曲、教學，著有音樂部落格：<a target="_blank" rel="noopener" href="https://rickmidi.blogspot.com/">喝咖啡聊音樂</a>。 -->

		<!-- v1 -->
		<!--
		<li>Software Developer</li>
		<li><a href="/categories/軟體測試/">SQA Manager</a></li>
		<li><a href="/categories/DevOps/">Operation Manager</a></li>
		<li><a target="_blank" rel="noopener" href="http://rickmidi.blogspot.com/">Musician and Guitarist</a></li>
		<li>
			<ol>
				<li>Management</li>
				<li>Cloud / Distributed Systems</li>
				<li>DevOps / SRE / </li>
			</ol>
		</li>
		-->

		<!--
		<h4>Donate</h4>
		<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
		<input type="hidden" name="cmd" value="_s-xclick" />
		<input type="hidden" name="hosted_button_id" value="UUMSV7TXWT2AJ" />
		<input type="image" src="https://www.paypalobjects.com/en_US/TW/i/btn/btn_donateCC_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
		<img alt="" border="0" src="https://www.paypal.com/en_TW/i/scr/pixel.gif" width="1" height="1" />
		</form>
		-->

		<h4>Facebook</h4>

		<div class="fb-page" data-href="https://www.facebook.com/completethink/" data-tabs="timeline" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/completethink/" class="fb-xfbml-parse-ignore"><a target="_blank" rel="noopener" href="https://www.facebook.com/completethink/">Complete Think</a></blockquote></div>

		<a target="_blank" rel="noopener" href="https://aws.amazon.com/developer/community/heroes/rick-hwang/"><img
				src="/images/About/AWS-Hero/community-heroes_logo.png"></a>

		<h4>AWS Certifications</h4>
		<a href="/2016/04/22/AWS/AWS-Certified-Solutions-Architect_Associate/"><img src="/images/About/Solutions_Architect-Associate.jpg"></a>
		<a href="/2016/07/29/AWS/AWS-Certified-SysOps-Administrator/"><img src="/images/About/SysOps-Administrator-Associate.png"></a>
		<a href="/2016/08/20/AWS/AWS-Certified-Developer/"><img src="/images/About/Developer-Associate.png"></a>
	</div>

	<hr />
</div><!-- col-md-3 -->

		

	</div><!-- row -->


    </div>
  </div>


<div class="container-narrow">
    <footer> <p>
  &copy; 2015-2022 Rick Hwang
  
      with help from <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme base on <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.
</p> </footer>
</div>

<!-- container-narrow -->

<div id="gotop">

  <!-- 
    <i class="fa fa-sitemap"></i> <a href="/2017/12/29/About/About-This-Blog/" title="About this blog" target="_blank"]);">關於這裡</a><br />
  
    <i class="fa fa-user"></i> <a href="/2017/12/29/About/About-Author/" title="" target="_blank"]);">關於作者</a><br />
  
    <i class="fa fa-book"></i> <a href="/2017/09/20/About/Learning-Approaches/" title="" target="_blank"]);">學習法則</a><br />
  
    <i class="fa fa-coffee"></i> <a href="https://www.gtcafe.com" title="GTCafe Studio" target="_blank"]);">GTCafe Studio</a><br />
  
    <i class="fa fa-music"></i> <a href="https://www.gtcafe.com/rickmidi/" title="喝咖啡 聊音樂 (v2021)" target="_blank"]);">喝咖啡 聊音樂 (v2021)</a><br />
   -->

  <!-- <h4>About</h4> -->

  
    <li><a href="/2035/01/21/Index/">全站索引</a></li>
  
    <li><a href="/2017/12/29/About/About-This-Blog/">關於這裏</a></li>
  
    <li><a href="/2017/12/29/About/About-Author/">關於作者</a></li>
  
    <li><a href="/2017/09/20/About/Learning-Approaches/">學習法則</a></li>
  
    <li><a href="/2017/11/26/Thinking-in-Essence/">思考本質</a></li>
  
    <li><a href="/2017/12/02/About/Epiphany/">一些領悟</a></li>
  
    <li><a href="/2014/10/26/Management/Classified-Philosophy/">分類哲學</a></li>
  

  <a href="#">▲ TOP ▲ </a>
</div>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/gtcafe-tracking.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);

// GTCafe API: completet
tracking_update();
</script>



</body>
</html>
